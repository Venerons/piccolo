<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width">
	<title>Piccolo</title>
	<style type="text/css">
		*, *::before, *::after {
			box-sizing: border-box;
			margin: 0;
			padding: 0;
		}
		html,
		body {
			width: 100%;
			height: 100%;
			font: 400 normal 14px/1.2 sans-serif;
			color: whitesmoke;
		}
		body {
			display: flex;
			flex-flow: column nowrap;
		}
		header {
			display: flex;
			flex-flow: row nowrap;
			align-items: center;
			height: 50px;
			padding: 0 1rem;
			background: #222;
			border-bottom: 2px solid dodgerblue;
			box-shadow: 0px 3px 5px 0px black;
			z-index: 100;
		}
		input {
			background: transparent;
			font: inherit;
			color: inherit;
			border: none;
			padding: 0.5rem 0;
			border-bottom: 1px solid rgba(255, 255, 255, 0.5);
		}
		input:focus {
			background: transparent;
			font: inherit;
			color: inherit;
			border: none;
			border-bottom: 1px solid whitesmoke;
		}
		button {
			background: none;
			font: inherit;
			color: dodgerblue;
			border: none;
			padding: 0.5rem 1rem;
			cursor: pointer;
		}
		button:hover,
		button:focus {
			background: rgba(255, 255, 255, 0.1);
		}
		button:active {
			background: whitesmoke;
		}
		.header-separator {
			height: 50%;
			margin: 0 1rem;
			border-left: 1px solid rgba(245, 245, 245, 0.3);
		}
		main {
			flex: 1;
			display: flex;
			flex-flow: row wrap;
			justify-content: flex-start;
			align-items: center;
			align-content: flex-start;
			overflow: auto;
			background: #222;
			padding: 0.5rem;
		}
		.item {
			margin: 0.5rem;
		}

		.backdrop {
			z-index: 199;
			position: fixed;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			background: rgba(55, 61, 73, 0.8);
		}
		.dialog {
			position: fixed;
			top: 50%;
			left: 50%;
			transform: translate(-50%, -50%);
			min-width: 300px;
			max-width: 100%;
			min-height: 200px;
			max-height: 100%;
			display: flex;
			flex-flow: column nowrap;
			background: #222;
			/*border: 1px solid rgba(30, 144, 255, 0.5);*/
			border-bottom: 2px solid dodgerblue;
			box-shadow: 0px 3px 5px 0px black;
			z-index: 200;
		}
		.dialog-header {
			min-height: 50px;
			text-align: center;
			padding: 1rem;
		}
		.dialog-content {
			flex: 1;
			padding: 1rem;
			overflow: auto;
		}
		.dialog-footer {
			min-height: 50px;
			text-align: right;
			padding: 1rem;
		}
	</style>
</head>
<body>
	<header>
		<datalist id="header-tags"></datalist>
		<input id="header-search" type="search" list="header-tags" placeholder="Tag..." style="flex: 1; margin-right: 1rem">
		<button id="header-filter">Filter</button>
		<div class="header-separator"></div>
		<button id="header-showtags">Tags</button>
		<div class="header-separator"></div>
		<button id="header-sort">Sort</button>
		<div class="header-separator"></div>
		<button id="header-load">Load</button>
	</header>
	<main></main>

	<div class="backdrop" style="display: none"></div>

	<div id="dialog-load" class="dialog" style="display: none">
		<div class="dialog-header">
			<h1>Load</h1>
		</div>
		<div class="dialog-content">
			<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vivamus vel neque nec magna lacinia commodo in vel ante. Aliquam tincidunt, purus sit amet congue placerat, lacus mauris rhoncus nisl, nec ornare libero purus eget augue. In sed dui placerat nisl cursus aliquet. Integer nisl lorem, maximus et viverra non, aliquet vel arcu. Cras ullamcorper, arcu id molestie scelerisque, est turpis interdum mauris, sit amet pretium mi lectus at metus. Phasellus ornare odio in ipsum faucibus, et tempus est porttitor. Nullam sollicitudin eleifend mi at semper. Vivamus vel neque nec magna lacinia commodo in vel ante. Aliquam tincidunt, purus sit amet congue placerat, lacus mauris rhoncus nisl, nec ornare libero purus eget augue.</p>
			<input type="file">
		</div>
		<div class="dialog-footer">
			<button id="dialog-load-close">Close</button>
			<button id="dialog-load-load">Load</button>
		</div>
	</div>

	<div id="dialog-pic" class="dialog" style="display: none">
		<div id="dialog-pic-content" class="dialog-content" style="text-align: center"></div>
	</div>

	<script src="https://code.jquery.com/jquery-3.1.0.js"></script>
	<script type="text/javascript">
		$('#header-load').on('click', function () {
			$('#dialog-load').show();
		});

		$('.backdrop').on('click', function () {
			$('.backdrop, .dialog').hide();
		});

		$('#dialog-load-close').on('click', function () {
			$('#dialog-load').hide();
		});

		$('#dialog-load-load').on('click', function () {
			// TODO
			$('#dialog-load').hide();
		});

		$('#header-filter').on('click', function () {
			showFilter($('#header-search').val());
		});

		function updateTagList() {
			var datalist = document.getElementById('header-tags');
			datalist.innerHTML = '';
			Object.keys(MAP.tags).forEach(function (tag) {
				var option = document.createElement('option');
				option.value = tag;
				datalist.appendChild(option);
			});
		}

		function showFilter(tag) {
			var $main = $('main').empty(),
				pics = MAP.tags[tag];
			if (!pics) {
				console.error('Tag "' + tag + '" not found!');
				return;
			}
			pics.sort(function (a, b) {
				return MAP.pics[a].timestamp > MAP.pics[b].timestamp ? -1 : 1;
			}).forEach(function (picID) {
				var ELEMENT_HEIGHT = 150,
					pic = MAP.pics[picID],
					ext = pic.path.substring(pic.path.lastIndexOf('.') + 1),
					element;
				if (['gif'].indexOf(ext) !== -1) {
					element = document.createElement('canvas');
					var context = element.getContext('2d'),
						img = new Image();
					img.onload = function () {
						element.height = ELEMENT_HEIGHT;
						element.width = ELEMENT_HEIGHT * img.width / img.height;
						context.drawImage(img, 0, 0, element.width, element.height);
					};
					img.src = pic.path;
				} else if (['webm', 'flv', 'mp4'].indexOf(ext) !== -1) {
					element = document.createElement('video');
					element.autoplay = false;
					element.controls = false;
					element.loop = true;
					element.onmouseover = function () {
						console.log(element);
						element.play();
					};
					element.onmouseout = function () {
						element.pause();
					};
					element.src = pic.path;
				} else {
					element = new Image();
					element.src = pic.path;
				}
				element.height = ELEMENT_HEIGHT;
				var $container = $('<div class="item" data-pic="' + picID + '"></div>');
				$container.append(element);
				$main.append($container);
			});
			$('.item', 'main').on('click', function () {
				var $item = $(this),
					picID = $item.data('pic'),
					pic = MAP.pics[picID],
					ext = pic.path.substring(pic.path.lastIndexOf('.') + 1);
				if (['png', 'jpg', 'jpeg', 'gif'].indexOf(ext) !== -1) {
					$('#dialog-pic-content').html('<img src="' + pic.path + '" style="max-width: 100%; max-height: 100%">');
				} else if (['webm', 'flv', 'mp4'].indexOf(ext) !== -1) {
					$('#dialog-pic-content').html('<video src="' + pic.path + '" autoplay loop controls style="max-width: 100%; max-height: 100%"></video>');
				}
				$('#dialog-pic, .backdrop').show();
			});
		}
	</script>
</body>
</html>
